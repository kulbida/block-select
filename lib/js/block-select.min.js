!function(){"use strict";jQuery.fn.extend({blockSelect:function(){jQuery(this).each(function(t,e){!function(){var i,a,o,n=!1,c=0,d=[],r=jQuery(e).data("id"),l={width:jQuery(e).data("width")||"300px"},s=function(t){return"<div class='presentation' data-object='presentation-"+t+"'><input type='text' data-object='input' autocomplete='off' placeholder='Start typing' /><ul data-object='autocomplete-list' class='hidden'></ul><div data-object='show-autocomplete'><span class='triangle'></span></div><ul data-object='selected-tags'></ul><select multiple='multiple' name='"+t+"' style='display:none' data-object='dest-select'></select></div>"};i=jQuery(e).find("li").map(function(t,e){return{id:jQuery(e).data("id"),title:jQuery(e).html(),selected:jQuery(e).data("selected")||!1,marked:!1}}).toArray(),a=i.filter(function(t){return t.selected}),o=i.filter(function(t){return!t.selected});var u=function(t){var e;return e=t.marked?"class='selected'":"","<li "+e+" data-object='selected-item' data-id='"+t.id+"' data-title='"+t.title+"'>"+t.title+"<a data-object='delete-tag-"+r+"' class='delete-tag' href='#'>&times;</a></li>"};jQuery(e).after(s(r));var p=jQuery(document).find("div[data-object='presentation-"+r+"']");p.find("[data-object='show-autocomplete']").on("click",function(t){n?p.trigger("hide-autocomplete-"+r):p.trigger("show-autocomplete-"+r,{event:t,value:""}),p.find("[data-object='input']").focus()}),p.find("[data-object='input']").on("keyup",function(t){if(27!==t.keyCode){var e=jQuery(t.target).val();p.trigger("show-autocomplete-"+r,{event:t,value:e})}}),p.find("[data-object='input']").on("keypress",function(t){var e=jQuery(t.target).val();if(0===e.length&&8===t.which){var i=a.slice(-1)[0];i.marked?(i=Object.assign({},i),i.marked=!1,o.push(i),a=a.filter(function(t){return t.id!==i.id})):i.marked=!0,p.trigger("display-selected-"+r)}switch(t.keyCode){case 38:p.trigger("go-up.autocomplete");break;case 40:n?p.trigger("go-down.autocomplete"):p.trigger("show-autocomplete-"+r,{event:t,value:e});break;case 13:if(!(n&&c>0))return!1;var d=p.find("[data-object='autocomplete-list'] > li:nth-child("+c+")").selector;return"undefined"!=typeof d&&p.trigger("select-autocomplete-item-"+r,d),c=0,!1;case 27:a=a.map(function(t){return t.marked=!1,t}),p.trigger("display-selected-"+r),p.trigger("hide-autocomplete-"+r)}}),p.on("highlight-item.autocomplete",function(t,e){p.find("[data-object='autocomplete-list'] > li").removeClass("hovered"),p.find("[data-object='autocomplete-list'] > li:nth-child("+e+")").addClass("hovered")}),p.on("go-up.autocomplete",function(){d.length&&(c--,c<=0&&(c=d.length),p.trigger("highlight-item.autocomplete",c))}),p.on("go-down.autocomplete",function(){d.length&&(c++,c>d.length&&(c=1),p.trigger("highlight-item.autocomplete",c))}),p.on("show-autocomplete-"+r,function(t,e){n=!0;var i=p.find("[data-object='show-autocomplete']");i.css("border-bottom","none");var l,s=p.find("[data-object='autocomplete-list']"),u=RegExp(e.value,"i");d=o.filter(function(t){return 0===e.value.length||(l=t.title.match(u)||void 0,l&&l.length&&!a.includes(e.value))}),d.length?s.html(d.map(function(t){return"<li data-object='autocomplete-item-"+r+"' data-id='"+t.id+"' data-title='"+t.title+"'>"+t.title+"</li>"}).join("")).removeClass("hidden"):s.html("<li class='nop'>No matches.</li>").removeClass("hidden"),p.trigger("highlight-item.autocomplete",c)}),p.on("hide-autocomplete-"+r,function(){n=!1,c=0,p.find("[data-object='autocomplete-list']").addClass("hidden");var t=p.find("[data-object='show-autocomplete']");t.css("border-bottom","1px solid #ccc")}),p.on("select-autocomplete-item-"+r,function(t,e){var i=jQuery(e);a=a.map(function(t){return t.marked=!1,t}),a.push(o.filter(function(t){return t.id===i.data("id")})[0]),o=o.filter(function(t){return t.id!==i.data("id")}),p.trigger("render-tags-"+r),p.trigger("render-selected-"+r),p.find("input[type='text']").val("").focus(),p.trigger("show-autocomplete-"+r,{event:t,value:""})}),p.on("render-tags-"+r,function(){var t=p.find("[data-object='selected-tags']"),e=function(t){return"<li data-object='selected-item' data-id='"+t.id+"' data-title='"+t.title+"'>"+t.title+"<a data-object='delete-tag-"+r+"' class='delete-tag' href='#'>&times;</a></li>"};t.html(a.map(function(t){return e(t)}).join(""))}),p.on("render-selected-"+r,function(){p.find("[data-object='dest-select']").html(a.map(function(t){return"<option selected='selected' value='"+t.id+"'>"+t.title+"</option>"}).join("")+o.filter(function(t){var e=a.map(function(t){return t.id});return!e.includes(t.id)}).map(function(t){return"<option value='"+t.id+"'>"+t.title+"</option>"}).join("")),p.trigger("adjust-input-paddings-"+r)}),p.on("delete-autocomplete-item-"+r,function(t,e){var i=jQuery(e);a=a.filter(function(t){return t.id!==i.data("id")}),o.push({id:i.data("id"),title:i.data("title")}),p.trigger("display-selected-"+r)}),p.on("adjust-input-paddings-"+r,function(){var e,i=p.find("[data-object='autocomplete-list']"),a=p.find("[data-object='input']"),o=p.find("[data-object='selected-tags']"),n=3,c=3;e=parseInt(o.height()),a.css("padding-top",e+c+"px"),a.css("padding-left",n+"px"),a.css("border","1px solid #ccc"),a.css("width",l.width),o.css("max-width",a.width()),a.css("padding-bottom","8px"),a.css("margin","0"),i.css("position","absolute"),i.css("padding","10px 0"),i.css("margin","0"),i.css("left","0"),i.css("margin-top","-5px"),i.css("width",parseInt(a.outerWidth(!0)+18)+"px"),i.css("display","block"),i.css("cursor","pointer");var d=l.width.replace("px","");p.css("width",d+"px");var r=p.find("[data-object='show-autocomplete']");r.css("height",parseInt(a.outerHeight(!0))-2+"px"),r.css("width","20px"),r.css("margin-right","-20px"),r.css("right","0"),r.css("top","0"),r.css("position","absolute"),i.css("z-index",9999+t);var s=r.find("span.triangle");s.css("top","44%"),s.css("left","10%"),s.css("position","absolute")}),p.on("display-selected-"+r,function(){var t=p.find("[data-object='selected-tags']");t.html(a.map(function(t){return u(t)}).join("")),p.find("input[type='text']").val("").focus(),p.trigger("render-selected-"+r)});var g=function(){jQuery(document).on("click","[data-object='autocomplete-item-"+r+"']",function(t){p.trigger("select-autocomplete-item-"+r,t.target)}),jQuery(document).on("click","a[data-object='delete-tag-"+r+"']",function(t){return p.trigger("delete-autocomplete-item-"+r,jQuery(t.target).parent("[data-object='selected-item']")),!1}),p.trigger("display-selected-"+r),p.trigger("render-selected-"+r),$(e).remove()};g()}()})}})}();