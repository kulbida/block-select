!function(){"use strict";jQuery.fn.extend({blockSelect:function(){jQuery(this).each(function(a,b){!function(){var c,d,e,f=!1,g=0,h=[],i=jQuery(b).data("id"),j={width:jQuery(b).data("width")||"300px"},k=function(a){return"<div class='presentation' data-object='presentation-"+a+"'><input type='text' data-object='input' autocomplete='off' placeholder='Start typing' /><ul data-object='autocomplete-list' class='hidden'></ul><div data-object='show-autocomplete'><span class='triangle'></span></div><ul data-object='selected-tags'></ul><select multiple='multiple' name='"+a+"' style='display:none' data-object='dest-select'></select></div>"};c=jQuery(b).find("li").map(function(a,b){return{id:jQuery(b).data("id"),title:jQuery(b).html(),selected:jQuery(b).data("selected")||!1,marked:!1}}).toArray(),d=c.filter(function(a){return a.selected}),e=c.filter(function(a){return!a.selected});var l=function(a){var b;return b=a.marked?"class='selected'":"","<li "+b+" data-object='selected-item' data-id='"+a.id+"' data-title='"+a.title+"'>"+a.title+"<a data-object='delete-tag-"+i+"' class='delete-tag' href='#'>&times;</a></li>"};jQuery(b).after(k(i));var m=jQuery(document).find("div[data-object='presentation-"+i+"']");m.find("[data-object='show-autocomplete']").on("click",function(a){f?m.trigger("hide-autocomplete-"+i):m.trigger("show-autocomplete-"+i,{event:a,value:""}),m.find("[data-object='input']").focus()}),m.find("[data-object='input']").on("keyup",function(a){if(27!==a.keyCode){var b=jQuery(a.target).val();m.trigger("show-autocomplete-"+i,{event:a,value:b})}}),m.find("[data-object='input']").on("keypress",function(a){var b=jQuery(a.target).val();if(0===b.length&&8===a.which){var c=d.slice(-1)[0];c.marked?(c=Object.assign({},c),c.marked=!1,e.push(c),d=d.filter(function(a){return a.id!==c.id})):c.marked=!0,m.trigger("display-selected-"+i)}switch(a.keyCode){case 38:m.trigger("go-up.autocomplete");break;case 40:f?m.trigger("go-down.autocomplete"):m.trigger("show-autocomplete-"+i,{event:a,value:b});break;case 13:if(!(f&&g>0))return!1;var h=m.find("[data-object='autocomplete-list'] > li:nth-child("+g+")").selector;return"undefined"!=typeof h&&m.trigger("select-autocomplete-item-"+i,h),g=0,!1;case 27:d=d.map(function(a){return a.marked=!1,a}),m.trigger("display-selected-"+i),m.trigger("hide-autocomplete-"+i)}}),m.on("highlight-item.autocomplete",function(a,b){m.find("[data-object='autocomplete-list'] > li").removeClass("hovered"),m.find("[data-object='autocomplete-list'] > li:nth-child("+b+")").addClass("hovered")}),m.on("go-up.autocomplete",function(a){h.length&&(g--,g<=0&&(g=h.length),m.trigger("highlight-item.autocomplete",g))}),m.on("go-down.autocomplete",function(a){h.length&&(g++,g>h.length&&(g=1),m.trigger("highlight-item.autocomplete",g))}),m.on("show-autocomplete-"+i,function(a,b){f=!0;var c=m.find("[data-object='show-autocomplete']");c.css("border-bottom","none");var l,j=m.find("[data-object='autocomplete-list']"),k=RegExp(b.value,"i");h=e.filter(function(a){return 0===b.value.length||(l=a.title.match(k)||void 0,l&&l.length&&!d.includes(b.value))}),h.length?j.html(h.map(function(a){return"<li data-object='autocomplete-item-"+i+"' data-id='"+a.id+"' data-title='"+a.title+"'>"+a.title+"</li>"}).join("")).removeClass("hidden"):j.html("<li class='nop'>No matches.</li>").removeClass("hidden"),m.trigger("highlight-item.autocomplete",g)}),m.on("hide-autocomplete-"+i,function(a,b){f=!1,g=0,m.find("[data-object='autocomplete-list']").addClass("hidden");var c=m.find("[data-object='show-autocomplete']");c.css("border-bottom","1px solid #ccc")}),m.on("select-autocomplete-item-"+i,function(a,b){var c=jQuery(b);d=d.map(function(a){return a.marked=!1,a}),d.push(e.filter(function(a){return a.id===c.data("id")})[0]),e=e.filter(function(a){return a.id!==c.data("id")}),m.trigger("render-tags-"+i),m.trigger("render-selected-"+i),m.find("input[type='text']").val("").focus(),m.trigger("show-autocomplete-"+i,{event:a,value:""})}),m.on("render-tags-"+i,function(a){var b=m.find("[data-object='selected-tags']"),c=function(a){return"<li data-object='selected-item' data-id='"+a.id+"' data-title='"+a.title+"'>"+a.title+"<a data-object='delete-tag-"+i+"' class='delete-tag' href='#'>&times;</a></li>"};b.html(d.map(function(a){return c(a)}).join(""))}),m.on("render-selected-"+i,function(a){m.find("[data-object='dest-select']").html(d.map(function(a){return"<option selected='selected' value='"+a.id+"'>"+a.title+"</option>"}).join("")+e.filter(function(a){var b=d.map(function(a){return a.id});return!b.includes(a.id)}).map(function(a){return"<option value='"+a.id+"'>"+a.title+"</option>"}).join("")),m.trigger("adjust-input-paddings-"+i)}),m.on("delete-autocomplete-item-"+i,function(a,b){var c=jQuery(b);d=d.filter(function(a){return a.id!==c.data("id")}),e.push({id:c.data("id"),title:c.data("title")}),m.trigger("display-selected-"+i)}),m.on("adjust-input-paddings-"+i,function(){var e,b=m.find("[data-object='autocomplete-list']"),c=m.find("[data-object='input']"),d=m.find("[data-object='selected-tags']"),g=3,h=3;e=parseInt(d.height());var i=d.find("li").toArray().map(function(a){return jQuery(a).outerWidth()});i.reduce(function(a,b){return a+b+6},0);c.css("padding-top",e+h+"px"),c.css("padding-left",g+"px"),c.css("border","1px solid #ccc"),c.css("width",j.width),d.css("max-width",c.width()),c.css("padding-bottom","8px"),c.css("margin","0"),b.css("position","absolute"),b.css("padding","10px 0"),b.css("margin","0"),b.css("left","0"),b.css("margin-top","-5px"),b.css("width",parseInt(c.outerWidth(!0)+18)+"px"),b.css("display","block"),b.css("cursor","pointer");var l=j.width.replace("px","");m.css("width",l+"px");var n=m.find("[data-object='show-autocomplete']");n.css("height",parseInt(c.outerHeight(!0))-2+"px"),n.css("width","20px"),n.css("margin-right","-20px"),n.css("right","0"),n.css("top","0"),n.css("position","absolute"),b.css("z-index",9999+a);var o=n.find("span.triangle");o.css("top","44%"),o.css("left","10%"),o.css("position","absolute")}),m.on("display-selected-"+i,function(){var a=m.find("[data-object='selected-tags']");a.html(d.map(function(a){return l(a)}).join("")),m.find("input[type='text']").val("").focus(),m.trigger("render-selected-"+i)});var n=function(){jQuery(document).on("click","[data-object='autocomplete-item-"+i+"']",function(a){m.trigger("select-autocomplete-item-"+i,a.target)}),jQuery(document).on("click","a[data-object='delete-tag-"+i+"']",function(a){return m.trigger("delete-autocomplete-item-"+i,jQuery(a.target).parent("[data-object='selected-item']")),!1}),m.trigger("display-selected-"+i),m.trigger("render-selected-"+i),$(b).remove()};n()}()})}})}();
